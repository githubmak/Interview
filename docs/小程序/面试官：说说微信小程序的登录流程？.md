# 面试官：说说微信小程序的登录流程？

微信小程序的登录流程主要可以概括为以下步骤:

## 一、获取code

1. 用户在小程序内点击登录按钮

2. 调用wx.login()获取code

## 二、获取openid

1. 将code发送到开发者服务器

2. 开发者服务器使用code向微信服务器获取openid和session_key


## 三、校验openid

1. 开发者服务器拿到openid,去数据库查询是否已存在

2. 若不存在,表示新用户,创建新记录

3. 若存在,校验用户信息,生成自定义登录态

## 四、返回登录态 

1. 开发者服务器将登录态返回给小程序

2. 小程序存储登录态到本地

## 五、校验登录态

1. 小程序重新启动时可校验登录态

2. 调用wx.checkSessionAPI验证登录态是否过期 

3. 过期则重新执行登录流程,未过期则继续使用

![image](https://github.com/linwu-hi/code-interview/assets/137023716/1808ddca-dea9-4880-a9b9-49cd97bab5fa)

综上,微信小程序的登录流程主要分为获取openid、生成和校验登录态几个步骤。具体实现还需要开发者服务器配合,参考微信官方文档。